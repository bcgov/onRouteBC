name: Notifications
on:
  workflow_run: 
    workflows: [PR,Merge]
jobs:
  notify-teams-in-progress:
    if: ${{github.action != 'completed'}}
    runs-on: ubuntu-22.04
    steps:
      - uses: simbo/msteams-message-card-action@latest
        with:
          webhook: ${{ vars.MS_TEAMS_WEBHOOK_URI }}
          title: "PR# ${{github.event.workflow_run.pull_requests[0].number}}"
          message: "${{github.event.workflow_run.head_commit.message}}" 
          color: ff69b4
          buttons: |
            PR ${{github.event.workflow_run.pull_requests[0].number}} https://github.com/bcgov/onroutebc/pull/${{github.event.workflow_run.pull_requests[0].number}}
            Diff https://github.com/bcgov/onroutebc/pull/${{github.event.workflow_run.pull_requests[0].number}}/files
          sections: |
            -
          text: |
            status: ${{github.event.workflow_run.status}}
            action: ${{github.action}}
  notify-teams-completed:
    if: ${{github.action == 'completed'}}
    runs-on: ubuntu-22.04
    steps:
      - uses: simbo/msteams-message-card-action@latest
        with:
          webhook: ${{ vars.MS_TEAMS_WEBHOOK_URI }}
          title: "PR# ${{github.event.workflow_run.pull_requests[0].number}}"
          message: "${{github.event.workflow_run.head_commit.message}}" 
          color: ff69b4
          buttons: |
            PR ${{github.event.workflow_run.pull_requests[0].number}} https://github.com/bcgov/onroutebc/pull/${{github.event.workflow_run.pull_requests[0].number}}
            Diff https://github.com/bcgov/onroutebc/pull/${{github.event.workflow_run.pull_requests[0].number}}/files
          sections: |
            -
              text: |
                status: ${{github.event.workflow_run.status}}
                action: ${{github.action}}
